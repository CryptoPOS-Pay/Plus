
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Paiement avec CryptoPOS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <img src="logo.png" alt="CryptoPOS Logo" class="logo">
        <h1>Paiement avec CryptoPOS</h1>
        <label for="amount">Montant (ETH)</label>
        <input type="text" id="amount" placeholder="0,01" oninput="convertToEUR()">

        <div id="converted"></div>

        <label for="merchant">Adresse du commerçant</label>
        <input type="text" id="merchant" value="0xee328ed15e857A539Ebccae130de04bE47cea897">

        <button onclick="pay()">Envoyer</button>

        <div id="status"></div>

        <div class="crypto-icons">
            <img src="eth.png" alt="Ethereum">
            <img src="polygon.png" alt="Polygon">
            <img src="bnb.png" alt="BNB Smart Chain">
        </div>
        <p class="network-info">Réseau Sepolia – Testnet</p>
    </div>

    <script>
        async function convertToEUR() {
            const ethAmount = document.getElementById('amount').value.replace(',', '.');
            const eurRate = 1411; // Test static rate
            const converted = parseFloat(ethAmount) * eurRate;
            document.getElementById('converted').innerText = `≈ ${converted.toFixed(2)} EUR`;
        }

        async function pay() {
            const amount = document.getElementById("amount").value.replace(',', '.');
            const merchant = document.getElementById("merchant").value;
            const ethValue = (parseFloat(amount) * 1e18).toString();

            if (typeof window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                const transactionParameters = {
                    to: merchant,
                    from: accounts[0],
                    value: parseInt(ethValue).toString(16)
                };

                try {
                    const txHash = await ethereum.request({
                        method: "eth_sendTransaction",
                        params: [transactionParameters],
                    });
                    document.getElementById("status").innerHTML = `<a href="https://sepolia.etherscan.io/tx/${txHash}" target="_blank">Voir la transaction sur Etherscan</a>`;
                } catch (error) {
                    document.getElementById("status").innerText = "Erreur lors de l'envoi : " + error.message;
                }
            } else {
                alert("Veuillez installer Metamask.");
            }
        }
    </script>
</body>
</html>
